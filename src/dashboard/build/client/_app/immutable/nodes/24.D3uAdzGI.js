import"../chunks/B17Q6ahh.js";import"../chunks/Bzak7iHL.js";import{aV as wt,p as kt,i as d,h as Dt,t as b,g as r,a as v,b as Tt,d as Z,c as i,r as s,s as tt,f as p,u as At,aT as R,aW as Lt}from"../chunks/_fu6EM7d.js";import{s as m}from"../chunks/DbFbsu9R.js";import{i as _}from"../chunks/BkvMZOlF.js";import{e as St,i as $t}from"../chunks/CdfWQzPM.js";import{b as Ft,r as Ot,s as jt}from"../chunks/BZKIRd09.js";import{b as Ct}from"../chunks/DD97wVFk.js";import{s as Bt,a as It}from"../chunks/CzA9-LZ0.js";import{p as Rt}from"../chunks/DDudHFlX.js";async function Et({fetch:y,params:u}){const w={credentials:"include"};try{const x=await y(`/api/admin/guilds/${u.guild}/tickets?limit=100`,w),h=x.ok?await x.json():[],g=Array.isArray(h)?h.filter(f=>f.transcript):[];return{transcripts:g,totalTranscripts:g.length}}catch(x){return console.error("Failed to load transcripts:",x),{transcripts:[],totalTranscripts:0}}}const ee=Object.freeze(Object.defineProperty({__proto__:null,load:Et},Symbol.toStringTag,{value:"Module"}));var Mt=p('<span class="ml-4"><i class="fa-solid fa-user"></i> </span>'),Nt=p('<div class="inline-flex items-center gap-2 rounded-full bg-red-100 px-3 py-1 text-sm text-red-700 dark:bg-red-900/30 dark:text-red-300"><i class="fa-solid fa-check-circle"></i> Closed</div>'),Ut=p('<div class="rounded-lg border border-gray-200 p-4 dark:border-gray-700"><div class="flex flex-col md:flex-row md:items-center md:justify-between mb-3"><div class="flex-1"><div class="font-semibold text-lg"><i class="fa-solid fa-hashtag text-gray-500 dark:text-slate-400"></i> </div> <div class="text-sm text-gray-600 dark:text-slate-400"> <!></div></div> <div class="mt-2 md:mt-0 text-right"><div class="text-sm font-medium text-gray-600 dark:text-slate-400"><!></div></div></div> <div class="flex flex-wrap gap-2 mb-4"><div class="inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-sm dark:bg-gray-800"><i class="fa-solid fa-clock"></i> </div> <div class="inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-sm dark:bg-gray-800"><i class="fa-solid fa-database"></i> </div> <!></div> <div class="flex gap-2"><button class="inline-flex items-center gap-2 rounded-lg bg-blue-300 px-4 py-2 font-medium transition duration-300 hover:bg-blue-500 hover:text-white dark:bg-blue-500/50 dark:hover:bg-blue-500"><i class="fa-solid fa-download"></i> Download HTML</button> <a target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 rounded-lg bg-gray-300 px-4 py-2 font-medium transition duration-300 hover:bg-gray-500 hover:text-white dark:bg-gray-700 dark:hover:bg-gray-600"><i class="fa-solid fa-external-link"></i> View Online</a></div></div>'),zt=p('<div class="space-y-4"></div>'),Kt=p('<div class="rounded-lg bg-white p-12 shadow-sm dark:bg-slate-700 text-center"><i class="fa-solid fa-search text-6xl text-gray-400 dark:text-gray-600 mb-4"></i> <p class="text-lg text-gray-600 dark:text-slate-400">No transcripts found matching your search</p></div>'),Vt=p('<div class="rounded-lg bg-white p-12 shadow-sm dark:bg-slate-700 text-center"><i class="fa-solid fa-inbox text-6xl text-gray-400 dark:text-gray-600 mb-4"></i> <p class="text-lg text-gray-600 dark:text-slate-400">No transcripts yet</p> <p class="text-sm text-gray-500 dark:text-slate-500 mt-2">Transcripts will appear here as tickets are closed</p></div>'),qt=p('<h1 class="m-4 text-center text-4xl font-bold">Ticket Transcripts & Archives</h1> <div class="mx-auto my-8 max-w-6xl px-4"><div class="grid grid-cols-1 gap-4 md:grid-cols-2 mb-8"><div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">Total Transcripts</div> <div class="mt-2 text-3xl font-bold"> </div></div> <div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">Total Size <i class="fa-solid fa-circle-question cursor-help text-gray-400 text-sm" title="Estimated total storage used by transcripts"></i></div> <div class="mt-2 text-3xl font-bold"><!></div></div></div> <div class="mb-8 rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="grid grid-cols-1 gap-4 md:grid-cols-2"><div><label class="block text-sm font-semibold mb-2">Search</label> <input type="text" placeholder="Search by topic, user ID, or ticket ID..." class="w-full rounded-lg border border-gray-200 bg-white px-4 py-2 dark:border-gray-600 dark:bg-slate-800"/></div> <div><label class="block text-sm font-semibold mb-2">Sort By</label> <select class="w-full rounded-lg border border-gray-200 bg-white px-4 py-2 dark:border-gray-600 dark:bg-slate-800"><option>Date (Newest First)</option><option>Duration (Longest First)</option></select></div></div></div> <!></div>',1);function ae(y,u){kt(u,!0);const w=()=>It(Rt,"$page",x),[x,h]=Bt();let g=Z(""),f=Z("date");const E=At(()=>u.data.transcripts.filter(t=>{var e,l,a;return((e=t.topic)==null?void 0:e.toLowerCase().includes(r(g).toLowerCase()))||((l=t.userId)==null?void 0:l.includes(r(g)))||((a=t.id)==null?void 0:a.includes(r(g)))}).sort((t,e)=>{if(r(f)==="date")return new Date(e.createdAt)-new Date(t.createdAt);if(r(f)==="duration"){const l=new Date(t.closedAt)-new Date(t.createdAt);return new Date(e.closedAt)-new Date(e.createdAt)-l}return 0})),et=(t,e)=>{if(!t||!e)return"N/A";const l=new Date(e)-new Date(t),a=Math.floor(l/36e5),n=Math.floor(l%36e5/6e4);return`${a}h ${n}m`},at=async t=>{try{const e=await fetch(`/api/admin/guilds/${w().params.guild}/tickets/${t}/transcript`,{credentials:"include"});if(!e.ok)throw new Error("Failed to download transcript");const l=await e.blob(),a=window.URL.createObjectURL(l),n=document.createElement("a");n.href=a,n.download=`transcript-${t}.html`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(a),document.body.removeChild(n)}catch(e){alert("Failed to download transcript: "+e.message)}};var M=qt(),N=d(Dt(M),2),k=i(N),D=i(k),U=d(i(D),2),rt=i(U,!0);s(U),s(D);var z=d(D,2),K=d(i(z),2),st=i(K);{var it=t=>{var e=R();b(l=>m(e,`${l??""} KB`),[()=>(u.data.transcripts.reduce((l,a)=>{var n;return l+(((n=a.transcript)==null?void 0:n.length)||0)},0)/1024).toFixed(2)]),v(t,e)},dt=t=>{var e=R("0 KB");v(t,e)};_(st,t=>{u.data.transcripts.length>0?t(it):t(dt,!1)})}s(K),s(z),s(k);var T=d(k,2),V=i(T),A=i(V),q=d(i(A),2);Ot(q),s(A);var H=d(A,2),L=d(i(H),2),S=i(L);S.value=S.__value="date";var P=d(S);P.value=P.__value="duration",s(L),s(H),s(V),s(T);var ot=d(T,2);{var lt=t=>{var e=zt();St(e,21,()=>r(E),$t,(l,a)=>{var n=Ut(),$=i(n),F=i($),O=i(F),vt=d(i(O));s(O);var Q=d(O,2),W=i(Q),gt=d(W);{var mt=o=>{var c=Mt(),I=d(i(c));s(c),b(()=>m(I,` ${r(a).userId??""}`)),v(o,c)};_(gt,o=>{r(a).userId&&o(mt)})}s(Q),s(F);var G=d(F,2),J=i(G),ut=i(J);{var pt=o=>{var c=R();b((I,yt)=>m(c,`${I??""}
									${yt??""}`),[()=>new Date(r(a).createdAt).toLocaleDateString(),()=>new Date(r(a).createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),v(o,c)};_(ut,o=>{r(a).createdAt&&o(pt)})}s(J),s(G),s($);var j=d($,2),C=i(j),xt=d(i(C));s(C);var B=d(C,2),ft=d(i(B));s(B);var bt=d(B,2);{var _t=o=>{var c=Nt();v(o,c)};_(bt,o=>{r(a).status==="CLOSED"&&o(_t)})}s(j);var X=d(j,2),Y=i(X),ht=d(Y,2);s(X),s(n),b((o,c)=>{m(vt,` ${(r(a).topic||`Ticket ${r(a).id}`)??""}`),m(W,`ID: ${r(a).id??""} `),m(xt,` Duration: ${o??""}`),m(ft,` Size: ${c??""} KB`),jt(ht,"href",`/transcript/${r(a).id}`)},[()=>et(r(a).createdAt,r(a).closedAt),()=>{var o;return(((o=r(a).transcript)==null?void 0:o.length)||0).toFixed(2)}]),Lt("click",Y,()=>at(r(a).id)),v(l,n)}),s(e),v(t,e)},nt=t=>{var e=Kt();v(t,e)},ct=t=>{var e=Vt();v(t,e)};_(ot,t=>{r(E).length>0?t(lt):r(g)?t(nt,1):t(ct,!1)})}s(N),b(()=>m(rt,u.data.totalTranscripts)),Ct(q,()=>r(g),t=>tt(g,t)),Ft(L,()=>r(f),t=>tt(f,t)),v(y,M),Tt(),h()}wt(["click"]);export{ae as component,ee as universal};
