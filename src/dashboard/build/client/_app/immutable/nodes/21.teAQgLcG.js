import"../chunks/B17Q6ahh.js";import"../chunks/Bzak7iHL.js";import{aU as aa,p as ea,d as at,U as Mt,i as e,h as ra,t as h,aV as ft,g as r,a as _,b as sa,c as a,r as t,s as J,f as u,u as L,aW as ia}from"../chunks/CWXCXDbJ.js";import{s as g}from"../chunks/BTVB6o0Y.js";import{i as Y}from"../chunks/BnKh12PZ.js";import{e as $,i as R}from"../chunks/DuqOsHh6.js";import{b as da,r as Ut,a as Lt,s as Bt}from"../chunks/DNgBoiT1.js";import{s as et}from"../chunks/C9yEqpEA.js";import{s as Ot}from"../chunks/CUQ3wp6X.js";import{p as la}from"../chunks/D8EB0mrL.js";import{s as oa,a as va}from"../chunks/DeGpVRd_.js";import{b as na}from"../chunks/BR6RR1uv.js";import{p as ca}from"../chunks/CjzHswfe.js";async function ga({fetch:q,params:B}){const O={credentials:"include"};try{const[P,K,v]=await Promise.all([q(`/api/admin/guilds/${B.guild}/feedback?limit=100`,O),q(`/api/admin/guilds/${B.guild}/analytics`,O),q(`/api/admin/guilds/${B.guild}/categories`,O)]),A=P.ok?await P.json():{feedback:[]},H=K.ok?await K.json():null,E=v.ok?await v.json():[],x=A.feedback||[],rt={total:A.totalCount||x.length,avgRating:A.avgRating||(x.length>0?(x.reduce((f,j)=>f+(j.rating||0),0)/x.length).toFixed(2):0),byRating:A.ratingCounts||{5:x.filter(f=>f.rating===5).length,4:x.filter(f=>f.rating===4).length,3:x.filter(f=>f.rating===3).length,2:x.filter(f=>f.rating===2).length,1:x.filter(f=>f.rating===1).length}},V={};return x.forEach(f=>{const j=f.categoryName||"Unknown";V[j]||(V[j]=[]),V[j].push(f)}),{feedback:x,stats:rt,feedbackByCategory:V,trend:A.trend||[],categories:E,analytics:H}}catch(P){return console.error("Failed to load feedback data:",P),{feedback:[],stats:{total:0,avgRating:0,byRating:{5:0,4:0,3:0,2:0,1:0}},feedbackByCategory:{},trend:[],categories:[],analytics:null}}}const Wa=Object.freeze(Object.defineProperty({__proto__:null,load:ga},Symbol.toStringTag,{value:"Module"}));var ba=u("<option> </option>"),ma=u("<i></i>"),xa=u('<div class="flex flex-col items-center gap-2 min-w-fit"><div class="relative h-40 flex items-end"><div class="w-8 bg-gradient-to-t from-blurple to-blue-400 rounded-t transition-all hover:from-blurple hover:to-blue-300"></div></div> <div class="text-xs text-gray-600 dark:text-slate-400 text-center whitespace-nowrap"> </div></div>'),_a=u('<div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700 mb-8"><h2 class="mb-6 text-2xl font-bold">Feedback Trends</h2> <div class="flex items-end gap-2 h-64 overflow-x-auto pb-4"></div></div>'),ua=u('<i class="fa-solid fa-star text-yellow-500"></i>'),fa=u('<i class="fa-solid fa-star text-gray-300"></i>'),pa=u("<span> </span>"),ya=u('<div class="flex items-center gap-4"><div class="w-24"><div class="flex items-center gap-1"><!> <!></div> <span class="text-sm font-medium"> </span></div> <div class="flex-1 bg-gray-200 dark:bg-gray-600 rounded-full h-8 overflow-hidden"><div class="bg-yellow-500 h-full flex items-center justify-center text-white text-sm font-medium transition-all"><!></div></div> <div class="w-16 text-right"><div class="font-semibold"> </div> <div class="text-xs text-gray-500"> </div></div></div>'),ha=u("<i></i>"),ka=u('<div class="text-center"><div class="text-sm font-medium mb-1"> </div> <div class="text-lg font-bold mb-1"> </div> <div class="text-xs bg-gray-100 dark:bg-slate-600 rounded px-2 py-1"> </div></div>'),wa=u('<div class="rounded-lg border border-gray-200 dark:border-gray-600 p-4 hover:shadow-md transition"><div class="flex items-center justify-between mb-4"><div class="font-semibold text-lg"> </div> <div class="flex items-center gap-3"><span class="text-sm text-gray-600 dark:text-slate-400"> </span> <div class="flex gap-1"></div> <span class="ml-4 text-sm font-medium text-gray-600 dark:text-slate-400"> </span></div></div> <div class="grid grid-cols-5 gap-2"></div></div>'),$a=u('<div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700 mb-8"><h2 class="mb-6 text-2xl font-bold">Feedback by Category</h2> <div class="space-y-4"></div></div>'),Ra=u("<i></i>"),Da=u('<p class="text-sm italic mb-2"> </p>'),Fa=u('<div class="text-xs text-gray-500"> </div>'),Ca=u('<div><div class="flex items-start justify-between mb-2"><div><div class="font-semibold"> </div> <div class="text-sm text-gray-600 dark:text-slate-400"> </div></div> <div class="flex items-center gap-2"><div class="flex gap-1"></div> <span class="font-semibold"> </span></div></div> <!> <!></div>'),Aa=u('<div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><h2 class="mb-6 text-2xl font-bold">Recent Feedback</h2> <div class="space-y-3 max-h-96 overflow-y-auto"></div></div>'),Sa=u('<div class="rounded-lg bg-white p-12 shadow-sm dark:bg-slate-700 text-center"><i class="fa-solid fa-inbox text-6xl text-gray-400 dark:text-gray-600 mb-4"></i> <p class="text-lg text-gray-600 dark:text-slate-400">No feedback for the selected period</p></div>'),ja=u('<h1 class="m-4 text-center text-4xl font-bold">Feedback & Analytics</h1> <div class="mx-auto my-8 max-w-6xl px-4"><div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700 mb-8"><h2 class="mb-4 text-xl font-bold">Filters</h2> <div class="grid grid-cols-1 gap-4 md:grid-cols-4"><div><label class="block text-sm font-medium mb-2">From Date</label> <input type="date" class="w-full px-3 py-2 border border-gray-300 rounded-md dark:bg-slate-600 dark:border-slate-500"/></div> <div><label class="block text-sm font-medium mb-2">To Date</label> <input type="date" class="w-full px-3 py-2 border border-gray-300 rounded-md dark:bg-slate-600 dark:border-slate-500"/></div> <div><label class="block text-sm font-medium mb-2">Category</label> <select class="w-full px-3 py-2 border border-gray-300 rounded-md dark:bg-slate-600 dark:border-slate-500"><option>All Categories</option><!></select></div> <div class="flex items-end"><button class="w-full px-4 py-2 bg-blurple text-white rounded-md hover:bg-blurple/90 disabled:opacity-50"> </button></div></div></div> <div class="grid grid-cols-1 gap-4 md:grid-cols-4 mb-8"><div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">Total Feedback</div> <div class="mt-2 text-3xl font-bold"> </div></div> <div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">Average Rating</div> <div class="mt-2 text-3xl font-bold"> </div> <div class="mt-1 flex gap-1"></div></div> <div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">5★ Excellent</div> <div class="mt-2 text-3xl font-bold text-green-600"> </div></div> <div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">1★ Terrible</div> <div class="mt-2 text-3xl font-bold text-red-600"> </div></div></div> <!> <div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700 mb-8"><h2 class="mb-6 text-2xl font-bold">Rating Distribution</h2> <div class="space-y-4"></div></div> <!> <!> <div class="mt-8 text-center"><a class="inline-block rounded-lg bg-blurple px-6 py-2 text-white transition duration-300 hover:bg-blurple/80">View Full Feedback Portal <i class="fa-solid fa-arrow-right-long ml-2"></i></a></div></div>',1);function Ya(q,B){ea(B,!0);const O=()=>va(ca,"$page",P),[P,K]=oa();let v=la(B,"data",7),A=at(Mt(new Date(Date.now()-720*60*60*1e3))),H=at(Mt(new Date)),E=at(""),x=at(!1);const rt=s=>({5:"Excellent",4:"Good",3:"Okay",2:"Poor",1:"Terrible"})[s]||"Unknown",V=s=>({5:"bg-green-100 dark:bg-green-900/30",4:"bg-blue-100 dark:bg-blue-900/30",3:"bg-yellow-100 dark:bg-yellow-900/30",2:"bg-orange-100 dark:bg-orange-900/30",1:"bg-red-100 dark:bg-red-900/30"})[s]||"bg-gray-100 dark:bg-gray-900/30";async function f(){J(x,!0);try{const s=Math.floor(r(A).getTime()/1e3),d=Math.floor(r(H).getTime()/1e3),o=new URLSearchParams({since:s.toString(),until:d.toString(),...r(E)&&{categoryId:r(E)}}),n=await fetch(`/api/admin/guilds/${O().params.guild}/feedback?${o}`,{credentials:"include"});if(n.ok){const i=await n.json();v().feedback=i.feedback,v().stats={total:i.totalCount,avgRating:i.avgRating,byRating:i.ratingCounts},v().trend=i.trend;const m={};i.feedback.forEach(p=>{const b=p.categoryName||"Unknown";m[b]||(m[b]=[]),m[b].push(p)}),v().feedbackByCategory=m}}finally{J(x,!1)}}function j(s){const d=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0");return`${d}-${o}-${n}`}function Pt(){return!v().trend||v().trend.length===0?1:Math.max(...v().trend.map(s=>s.count||0))||1}var pt=ja(),yt=e(ra(pt),2),st=a(yt),ht=e(a(st),2),it=a(ht),Q=e(a(it),2);Ut(Q),t(it);var dt=e(it,2),X=e(a(dt),2);Ut(X),t(dt);var lt=e(dt,2),Z=e(a(lt),2),ot=a(Z);ot.value=ot.__value="";var Et=e(ot);$(Et,17,()=>v().categories||[],R,(s,d)=>{var o=ba(),n=a(o,!0);t(o);var i={};h(()=>{g(n,r(d).name),i!==(i=r(d).id)&&(o.value=(o.__value=r(d).id)??"")}),_(s,o)}),t(Z),t(lt);var kt=e(lt,2),tt=a(kt),Vt=a(tt,!0);t(tt),t(kt),t(ht),t(st);var vt=e(st,2),nt=a(vt),wt=e(a(nt),2),It=a(wt,!0);t(wt),t(nt);var ct=e(nt,2),gt=e(a(ct),2),zt=a(gt);t(gt);var $t=e(gt,2);$($t,20,()=>Array(5),R,(s,d,o)=>{var n=ma();h(i=>et(n,1,i),[()=>`fa-solid fa-star text-sm ${o<Math.round(v().stats.avgRating||0)?"text-yellow-500":"text-gray-300"}`]),_(s,n)}),t($t),t(ct);var bt=e(ct,2),Rt=e(a(bt),2),Gt=a(Rt,!0);t(Rt),t(bt);var Dt=e(bt,2),Ft=e(a(Dt),2),Wt=a(Ft,!0);t(Ft),t(Dt),t(vt);var Ct=e(vt,2);{var Yt=s=>{var d=_a(),o=e(a(d),2);$(o,21,()=>v().trend,R,(n,i)=>{var m=xa(),p=a(m),b=a(p);t(p);var k=e(p,2),D=a(k,!0);t(k),t(m),h((F,w)=>{Ot(b,F),Bt(b,"title",`${r(i).count} feedback (avg rating: ${r(i).avgRating}/5)`),g(D,w)},[()=>`height: ${r(i).count/Pt()*160}px`,()=>new Date(r(i).date).toLocaleDateString("en-US",{month:"short",day:"numeric"})]),_(n,m)}),t(o),t(d),_(s,d)};Y(Ct,s=>{v().trend&&v().trend.length>0&&s(Yt)})}var mt=e(Ct,2),At=e(a(mt),2);$(At,20,()=>[5,4,3,2,1],R,(s,d)=>{const o=L(()=>{var l;return((l=v().stats.byRating)==null?void 0:l[d])||0}),n=L(()=>v().stats.total>0?r(o)/v().stats.total*100:0);var i=ya(),m=a(i),p=a(m),b=a(p);$(b,17,()=>Array(d),R,(l,c)=>{var y=ua();_(l,y)});var k=e(b,2);$(k,17,()=>Array(5-d),R,(l,c)=>{var y=fa();_(l,y)}),t(p);var D=e(p,2),F=a(D,!0);t(D),t(m);var w=e(m,2),T=a(w),N=a(T);{var M=l=>{var c=pa(),y=a(c,!0);t(c),h(()=>g(y,r(o))),_(l,c)};Y(N,l=>{r(n)>15&&l(M)})}t(T),t(w);var I=e(w,2),C=a(I),z=a(C,!0);t(C);var G=e(C,2),W=a(G);t(G),t(I),t(i),h((l,c)=>{g(F,l),Ot(T,`width: ${r(n)}%`),g(z,r(o)),g(W,`${c??""}%`)},[()=>rt(d),()=>r(n).toFixed(1)]),_(s,i)}),t(At),t(mt);var St=e(mt,2);{var qt=s=>{var d=$a(),o=e(a(d),2);$(o,21,()=>Object.entries(v().feedbackByCategory||{}),R,(n,i)=>{var m=L(()=>ia(r(i),2));let p=()=>r(m)[0],b=()=>r(m)[1];const k=L(()=>b().length>0?(b().reduce((l,c)=>l+(c.rating||0),0)/b().length).toFixed(2):0);var D=wa(),F=a(D),w=a(F),T=a(w,!0);t(w);var N=e(w,2),M=a(N),I=a(M);t(M);var C=e(M,2);$(C,20,()=>Array(5),R,(l,c,y)=>{var S=ha();h(U=>et(S,1,U),[()=>`fa-solid fa-star text-sm ${y<Math.round(r(k))?"text-yellow-500":"text-gray-300"}`]),_(l,S)}),t(C);var z=e(C,2),G=a(z);t(z),t(N),t(F);var W=e(F,2);$(W,20,()=>[5,4,3,2,1],R,(l,c)=>{const y=L(()=>b().filter(ut=>ut.rating===c).length),S=L(()=>b().length>0?r(y)/b().length*100:0);var U=ka(),xt=a(U),Xt=a(xt);t(xt);var _t=e(xt,2),Zt=a(_t,!0);t(_t);var Nt=e(_t,2),ta=a(Nt);t(Nt),t(U),h(ut=>{g(Xt,`${c??""}★`),g(Zt,r(y)),g(ta,`${ut??""}%`)},[()=>r(S).toFixed(0)]),_(l,U)}),t(W),t(D),h(()=>{g(T,p()),g(I,`${r(k)??""} / 5`),g(G,`${b().length??""} feedback`)}),_(n,D)}),t(o),t(d),_(s,d)},Ht=L(()=>Object.keys(v().feedbackByCategory||{}).length>0);Y(St,s=>{r(Ht)&&s(qt)})}var jt=e(St,2);{var Jt=s=>{var d=Aa(),o=e(a(d),2);$(o,21,()=>v().feedback.slice(0,20),R,(n,i)=>{var m=Ca(),p=a(m),b=a(p),k=a(b),D=a(k,!0);t(k);var F=e(k,2),w=a(F);t(F),t(b);var T=e(b,2),N=a(T);$(N,20,()=>Array(5),R,(l,c,y)=>{var S=Ra();h(()=>et(S,1,`fa-solid fa-star text-sm ${y<r(i).rating?"text-yellow-500":"text-gray-400"}`)),_(l,S)}),t(N);var M=e(N,2),I=a(M);t(M),t(T),t(p);var C=e(p,2);{var z=l=>{var c=Da(),y=a(c);t(c),h(()=>g(y,`"${r(i).comment??""}"`)),_(l,c)};Y(C,l=>{r(i).comment&&l(z)})}var G=e(C,2);{var W=l=>{var c=Fa(),y=a(c);t(c),h((S,U)=>g(y,`${S??""} at 
								${U??""}`),[()=>new Date(r(i).createdAt).toLocaleDateString(),()=>new Date(r(i).createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),_(l,c)};Y(G,l=>{r(i).createdAt&&l(W)})}t(m),h(l=>{et(m,1,l),g(D,r(i).categoryName||"Unknown"),g(w,`Ticket #${(r(i).ticketNumber||"N/A")??""}`),g(I,`${r(i).rating??""}/5`)},[()=>`rounded-lg p-4 ${V(r(i).rating)}`]),_(n,m)}),t(o),t(d),_(s,d)},Kt=s=>{var d=Sa();_(s,d)};Y(jt,s=>{(v().feedback||[]).length>0?s(Jt):s(Kt,!1)})}var Tt=e(jt,2),Qt=a(Tt);t(Tt),t(yt),h((s,d)=>{var o,n;Lt(Q,s),Q.disabled=r(x),Lt(X,d),X.disabled=r(x),Z.disabled=r(x),tt.disabled=r(x),g(Vt,r(x)?"Loading...":"Apply Filters"),g(It,v().stats.total||0),g(zt,`${(v().stats.avgRating||0)??""} / 5`),g(Gt,((o=v().stats.byRating)==null?void 0:o[5])||0),g(Wt,((n=v().stats.byRating)==null?void 0:n[1])||0),Bt(Qt,"href",`${na}/${O().params.guild}/feedback`)},[()=>j(r(A)),()=>j(r(H))]),ft("change",Q,s=>J(A,new Date(s.target.value),!0)),ft("change",X,s=>J(H,new Date(s.target.value),!0)),da(Z,()=>r(E),s=>J(E,s)),ft("click",tt,f),_(q,pt),sa(),K()}aa(["change","click"]);export{Ya as component,Wa as universal};
