import"../chunks/B17Q6ahh.js";import"../chunks/Bzak7iHL.js";import{aV as Mt,p as qt,d as h,U as Bt,i,h as Nt,t as y,aW as z,g as a,a as o,b as Pt,c as r,r as s,j as K,s as n,f as v,aT as V}from"../chunks/_fu6EM7d.js";import{s as u}from"../chunks/DbFbsu9R.js";import{i as _}from"../chunks/BkvMZOlF.js";import{e as zt,i as Kt}from"../chunks/CdfWQzPM.js";import{b as Vt,r as Wt,s as Ht}from"../chunks/BZKIRd09.js";import{b as Qt}from"../chunks/DD97wVFk.js";import{s as Gt,a as Jt}from"../chunks/CzA9-LZ0.js";import{p as Xt}from"../chunks/Ou6NtD-m.js";async function Yt({fetch:W,params:H}){try{return{transcripts:[],totalTranscripts:0,searched:!1}}catch(k){return console.error("Failed to load transcripts:",k),{transcripts:[],totalTranscripts:0,searched:!1}}}const _a=Object.freeze(Object.defineProperty({__proto__:null,load:Yt},Symbol.toStringTag,{value:"Module"}));var Zt=v('<span class="text-base">Searching...</span>'),ta=v('<i class="fa-solid fa-spinner animate-spin mr-2"></i> Searching...',1),aa=v('<i class="fa-solid fa-search mr-2"></i> Search',1),ea=v('<div class="rounded-lg bg-white p-12 shadow-sm dark:bg-slate-700 text-center"><i class="fa-solid fa-spinner animate-spin text-6xl text-gray-400 dark:text-gray-600 mb-4"></i> <p class="text-lg text-gray-600 dark:text-slate-400">Searching transcripts...</p></div>'),ra=v('<span class="ml-4"><i class="fa-solid fa-user"></i> </span>'),sa=v('<div class="inline-flex items-center gap-2 rounded-full bg-red-100 px-3 py-1 text-sm text-red-700 dark:bg-red-900/30 dark:text-red-300"><i class="fa-solid fa-check-circle"></i> Closed</div>'),ia=v('<div class="rounded-lg border border-gray-200 p-4 dark:border-gray-700"><div class="flex flex-col md:flex-row md:items-center md:justify-between mb-3"><div class="flex-1"><div class="font-semibold text-lg"><i class="fa-solid fa-hashtag text-gray-500 dark:text-slate-400"></i> </div> <div class="text-sm text-gray-600 dark:text-slate-400"> <!></div></div> <div class="mt-2 md:mt-0 text-right"><div class="text-sm font-medium text-gray-600 dark:text-slate-400"><!></div></div></div> <div class="flex flex-wrap gap-2 mb-4"><div class="inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-sm dark:bg-gray-800"><i class="fa-solid fa-clock"></i> </div> <div class="inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-sm dark:bg-gray-800"><i class="fa-solid fa-database"></i> </div> <!></div> <div class="flex gap-2"><button class="inline-flex items-center gap-2 rounded-lg bg-blue-300 px-4 py-2 font-medium transition duration-300 hover:bg-blue-500 hover:text-white dark:bg-blue-500/50 dark:hover:bg-blue-500"><i class="fa-solid fa-download"></i> Download HTML</button> <a target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 rounded-lg bg-gray-300 px-4 py-2 font-medium transition duration-300 hover:bg-gray-500 hover:text-white dark:bg-gray-700 dark:hover:bg-gray-600"><i class="fa-solid fa-external-link"></i> View Online</a></div></div>'),da=v('<div class="space-y-4"><div class="text-sm text-gray-600 dark:text-slate-400 mb-4"> </div> <!></div>'),la=v('<div class="rounded-lg bg-white p-12 shadow-sm dark:bg-slate-700 text-center"><i class="fa-solid fa-search text-6xl text-gray-400 dark:text-gray-600 mb-4"></i> <p class="text-lg text-gray-600 dark:text-slate-400">No transcripts found matching your search</p></div>'),oa=v('<div class="rounded-lg bg-white p-12 shadow-sm dark:bg-slate-700 text-center"><i class="fa-solid fa-inbox text-6xl text-gray-400 dark:text-gray-600 mb-4"></i> <p class="text-lg text-gray-600 dark:text-slate-400">Enter a search query to find transcripts</p> <p class="text-sm text-gray-500 dark:text-slate-500 mt-2">Search by ticket ID, topic, or user ID to view closed ticket transcripts</p></div>'),na=v('<h1 class="m-4 text-center text-4xl font-bold">Ticket Transcripts & Archives</h1> <div class="mx-auto my-8 max-w-6xl px-4"><div class="grid grid-cols-1 gap-4 md:grid-cols-2 mb-8"><div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">Results Found</div> <div class="mt-2 text-3xl font-bold"> </div></div> <div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">Status <i class="fa-solid fa-circle-question cursor-help text-gray-400 text-sm" title="Search status"></i></div> <div class="mt-2 text-3xl font-bold"><!></div></div></div> <div class="mb-8 rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="grid grid-cols-1 gap-4 md:grid-cols-3"><div class="md:col-span-2"><label class="block text-sm font-semibold mb-2">Search Transcripts</label> <input type="text" placeholder="Search by topic, user ID, or ticket ID..." class="w-full rounded-lg border border-gray-200 bg-white px-4 py-2 dark:border-gray-600 dark:bg-slate-800"/> <p class="text-xs text-gray-500 dark:text-slate-400 mt-2">Press Enter or click Search to find transcripts (up to 20 results)</p></div> <div><label class="block text-sm font-semibold mb-2">Sort By</label> <select class="w-full rounded-lg border border-gray-200 bg-white px-4 py-2 dark:border-gray-600 dark:bg-slate-800"><option>Date (Newest First)</option><option>Duration (Longest First)</option></select></div></div> <button class="mt-4 rounded-lg bg-blurple px-6 py-2 font-medium text-white transition duration-300 hover:bg-blurple/80 disabled:opacity-50 disabled:cursor-not-allowed"><!></button></div> <!></div>',1);function ya(W,H){qt(H,!0);const k=()=>Jt(Xt,"$page",ot),[ot,nt]=Gt();let w=h(""),$=h("date"),S=h(!1),b=h(!1),f=h(Bt([])),x=h(0);const ct=(t,e)=>{if(!t||!e)return"N/A";const c=new Date(e)-new Date(t),m=Math.floor(c/36e5),p=Math.floor(c%36e5/6e4);return`${m}h ${p}m`},Q=async()=>{if(!a(w).trim()){n(f,[],!0),n(S,!1),n(x,0);return}n(b,!0),n(S,!0);try{const t=new URLSearchParams({query:a(w),limit:"20",sort:a($)}),e=await fetch(`/api/admin/guilds/${k().params.guild}/tickets?${t.toString()}`,{credentials:"include"});if(e.ok){const c=await e.json();n(f,Array.isArray(c.tickets)?c.tickets.filter(m=>m.transcript).slice(0,20):[],!0),n(x,a(f).length,!0)}else n(f,[],!0),n(x,0)}catch(t){console.error("Search failed:",t),n(f,[],!0),n(x,0)}finally{n(b,!1)}},vt=t=>{t.key==="Enter"&&Q()},gt=async t=>{try{const e=await fetch(`/api/admin/guilds/${k().params.guild}/tickets/${t}/transcript`,{credentials:"include"});if(!e.ok)throw new Error("Failed to download transcript");const c=await e.blob(),m=window.URL.createObjectURL(c),p=document.createElement("a");p.href=m,p.download=`transcript-${t}.html`,document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(m),document.body.removeChild(p)}catch(e){alert("Failed to download transcript: "+e.message)}};var G=na(),J=i(Nt(G),2),L=r(J),T=r(L),X=i(r(T),2),pt=r(X,!0);s(X),s(T);var Y=i(T,2),Z=i(r(Y),2),mt=r(Z);{var ut=t=>{var e=Zt();o(t,e)},ft=t=>{var e=V("Ready");o(t,e)},xt=t=>{var e=V("Waiting for search");o(t,e)};_(mt,t=>{a(b)?t(ut):a(S)?t(ft,1):t(xt,!1)})}s(Z),s(Y),s(L);var A=i(L,2),R=r(A),F=r(R),j=i(r(F),2);Wt(j),K(2),s(F);var tt=i(F,2),E=i(r(tt),2),I=r(E);I.value=I.__value="date";var at=i(I);at.value=at.__value="duration",s(E),s(tt),s(R);var D=i(R,2),bt=r(D);{var ht=t=>{var e=ta();K(),o(t,e)},_t=t=>{var e=aa();K(),o(t,e)};_(bt,t=>{a(b)?t(ht):t(_t,!1)})}s(D),s(A);var yt=i(A,2);{var kt=t=>{var e=ea();o(t,e)},wt=t=>{var e=da(),c=r(e),m=r(c);s(c);var p=i(c,2);zt(p,17,()=>a(f),Kt,($t,l)=>{var O=ia(),U=r(O),C=r(U),M=r(C),Lt=i(r(M));s(M);var et=i(M,2),rt=r(et),Tt=i(rt);{var At=d=>{var g=ra(),P=i(r(g));s(g),y(()=>u(P,` ${a(l).userId??""}`)),o(d,g)};_(Tt,d=>{a(l).userId&&d(At)})}s(et),s(C);var st=i(C,2),it=r(st),Rt=r(it);{var Ft=d=>{var g=V();y((P,Ct)=>u(g,`${P??""}
									${Ct??""}`),[()=>new Date(a(l).createdAt).toLocaleDateString(),()=>new Date(a(l).createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),o(d,g)};_(Rt,d=>{a(l).createdAt&&d(Ft)})}s(it),s(st),s(U);var q=i(U,2),B=r(q),jt=i(r(B));s(B);var N=i(B,2),Et=i(r(N));s(N);var It=i(N,2);{var Ot=d=>{var g=sa();o(d,g)};_(It,d=>{a(l).status==="CLOSED"&&d(Ot)})}s(q);var dt=i(q,2),lt=r(dt),Ut=i(lt,2);s(dt),s(O),y((d,g)=>{u(Lt,` ${(a(l).topic||`Ticket ${a(l).id}`)??""}`),u(rt,`ID: ${a(l).id??""} `),u(jt,` Duration: ${d??""}`),u(Et,` Size: ${g??""} KB`),Ht(Ut,"href",`/transcript/${a(l).id}`)},[()=>ct(a(l).createdAt,a(l).closedAt),()=>{var d;return(((d=a(l).transcript)==null?void 0:d.length)||0).toFixed(2)}]),z("click",lt,()=>gt(a(l).id)),o($t,O)}),s(e),y(()=>u(m,`Found ${a(x)??""} transcript${a(x)!==1?"s":""} (showing up to 20 results)`)),o(t,e)},St=t=>{var e=la();o(t,e)},Dt=t=>{var e=oa();o(t,e)};_(yt,t=>{a(b)?t(kt):a(f).length>0?t(wt,1):a(S)?t(St,2):t(Dt,!1)})}s(J),y(()=>{u(pt,a(x)),D.disabled=a(b)}),z("keydown",j,vt),Qt(j,()=>a(w),t=>n(w,t)),Vt(E,()=>a($),t=>n($,t)),z("click",D,Q),o(W,G),Pt(),nt()}Mt(["keydown","click"]);export{ya as component,_a as universal};
