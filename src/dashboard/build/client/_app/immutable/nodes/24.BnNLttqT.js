import"../chunks/B17Q6ahh.js";import"../chunks/Bzak7iHL.js";import{aV as Mt,p as Ot,d as k,U as Nt,i as d,h as Pt,t as S,aW as K,g as e,a as l,b as qt,c as s,r as i,j as V,s as n,f as g,aT as W}from"../chunks/_fu6EM7d.js";import{s as x}from"../chunks/DbFbsu9R.js";import{i as D}from"../chunks/BkvMZOlF.js";import{e as zt,i as Kt}from"../chunks/CdfWQzPM.js";import{b as Vt,r as Wt,s as Ht}from"../chunks/BZKIRd09.js";import{b as Qt}from"../chunks/DD97wVFk.js";import{s as Gt,a as Jt}from"../chunks/CzA9-LZ0.js";import{p as Xt}from"../chunks/NesQCFKI.js";async function Yt({fetch:H,params:Q}){try{return{transcripts:[],totalTranscripts:0,searched:!1}}catch(A){return console.error("Failed to load transcripts:",A),{transcripts:[],totalTranscripts:0,searched:!1}}}const _e=Object.freeze(Object.defineProperty({__proto__:null,load:Yt},Symbol.toStringTag,{value:"Module"}));var Zt=g('<span class="text-base">Searching...</span>'),te=g('<i class="fa-solid fa-spinner animate-spin mr-2"></i> Searching...',1),ee=g('<i class="fa-solid fa-search mr-2"></i> Search',1),ae=g('<div class="rounded-lg bg-white p-12 shadow-sm dark:bg-slate-700 text-center"><i class="fa-solid fa-spinner animate-spin text-6xl text-gray-400 dark:text-gray-600 mb-4"></i> <p class="text-lg text-gray-600 dark:text-slate-400">Searching transcripts...</p></div>'),re=g('<span class="ml-4"><i class="fa-solid fa-user"></i> </span>'),se=g('<div class="inline-flex items-center gap-2 rounded-full bg-red-100 px-3 py-1 text-sm text-red-700 dark:bg-red-900/30 dark:text-red-300"><i class="fa-solid fa-check-circle"></i> Closed</div>'),ie=g('<div class="rounded-lg border border-gray-200 p-4 dark:border-gray-700"><div class="flex flex-col md:flex-row md:items-center md:justify-between mb-3"><div class="flex-1"><div class="font-semibold text-lg"><i class="fa-solid fa-hashtag text-gray-500 dark:text-slate-400"></i> </div> <div class="text-sm text-gray-600 dark:text-slate-400"> <!></div></div> <div class="mt-2 md:mt-0 text-right"><div class="text-sm font-medium text-gray-600 dark:text-slate-400"><!></div></div></div> <div class="flex flex-wrap gap-2 mb-4"><div class="inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-sm dark:bg-gray-800"><i class="fa-solid fa-clock"></i> </div> <div class="inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-sm dark:bg-gray-800"><i class="fa-solid fa-database"></i> </div> <!></div> <div class="flex gap-2"><button class="inline-flex items-center gap-2 rounded-lg bg-blue-300 px-4 py-2 font-medium transition duration-300 hover:bg-blue-500 hover:text-white dark:bg-blue-500/50 dark:hover:bg-blue-500"><i class="fa-solid fa-download"></i> Download HTML</button> <a target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 rounded-lg bg-gray-300 px-4 py-2 font-medium transition duration-300 hover:bg-gray-500 hover:text-white dark:bg-gray-700 dark:hover:bg-gray-600"><i class="fa-solid fa-external-link"></i> View Online</a></div></div>'),de=g('<div class="space-y-4"><div class="text-sm text-gray-600 dark:text-slate-400 mb-4"> </div> <!></div>'),oe=g('<div class="rounded-lg bg-white p-12 shadow-sm dark:bg-slate-700 text-center"><i class="fa-solid fa-search text-6xl text-gray-400 dark:text-gray-600 mb-4"></i> <p class="text-lg text-gray-600 dark:text-slate-400">No transcripts found matching your search</p></div>'),le=g('<div class="rounded-lg bg-white p-12 shadow-sm dark:bg-slate-700 text-center"><i class="fa-solid fa-inbox text-6xl text-gray-400 dark:text-gray-600 mb-4"></i> <p class="text-lg text-gray-600 dark:text-slate-400">Enter a search query to find transcripts</p> <p class="text-sm text-gray-500 dark:text-slate-500 mt-2">Search by ticket ID, topic, or user ID to view closed ticket transcripts</p></div>'),ne=g('<h1 class="m-4 text-center text-4xl font-bold">Ticket Transcripts & Archives</h1> <div class="mx-auto my-8 max-w-6xl px-4"><div class="grid grid-cols-1 gap-4 md:grid-cols-2 mb-8"><div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">Results Found</div> <div class="mt-2 text-3xl font-bold"> </div></div> <div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">Status <i class="fa-solid fa-circle-question cursor-help text-gray-400 text-sm" title="Search status"></i></div> <div class="mt-2 text-3xl font-bold"><!></div></div></div> <div class="mb-8 rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="grid grid-cols-1 gap-4 md:grid-cols-3"><div class="md:col-span-2"><label class="block text-sm font-semibold mb-2">Search Transcripts</label> <input type="text" placeholder="Search by topic, user ID, or ticket ID..." class="w-full rounded-lg border border-gray-200 bg-white px-4 py-2 dark:border-gray-600 dark:bg-slate-800"/> <p class="text-xs text-gray-500 dark:text-slate-400 mt-2">Press Enter or click Search to find transcripts (up to 20 results)</p></div> <div><label class="block text-sm font-semibold mb-2">Sort By</label> <select class="w-full rounded-lg border border-gray-200 bg-white px-4 py-2 dark:border-gray-600 dark:bg-slate-800"><option>Date (Newest First)</option><option>Duration (Longest First)</option></select></div></div> <button class="mt-4 rounded-lg bg-blurple px-6 py-2 font-medium text-white transition duration-300 hover:bg-blurple/80 disabled:opacity-50 disabled:cursor-not-allowed"><!></button></div> <!></div>',1);function ye(H,Q){Ot(Q,!0);const A=()=>Jt(Xt,"$page",nt),[nt,ct]=Gt();let _=k(""),R=k("date"),T=k(!1),y=k(!1),w=k(Nt([])),b=k(0);const vt=(t,a)=>{if(!t||!a)return"N/A";const c=new Date(a)-new Date(t),f=Math.floor(c/36e5),v=Math.floor(c%36e5/6e4);return`${f}h ${v}m`},G=async()=>{if(!e(_).trim()){n(w,[],!0),n(T,!1),n(b,0);return}n(y,!0),n(T,!0);try{const t=new URLSearchParams({since:Math.floor(Date.now()/1e3)-31536e3}),a=await fetch(`/api/admin/guilds/${A().params.guild}/tickets?${t.toString()}`,{credentials:"include"});if(a.ok){const c=await a.json(),f=Array.isArray(c)?c:Array.isArray(c.tickets)?c.tickets:[],v=e(_).toLowerCase(),L=f.filter(r=>r.htmlTranscript||r.transcriptUrl).filter(r=>!r.open).filter(r=>{var p,m,h;return((p=r.id)==null?void 0:p.toString().includes(e(_)))||((m=r.topic)==null?void 0:m.toLowerCase().includes(v))||((h=r.createdById)==null?void 0:h.toString().includes(e(_)))}).sort((r,p)=>{if(e(R)==="duration"){const m=new Date(p.closedAt)-new Date(r.createdAt);return new Date(p.closedAt)-new Date(r.createdAt)-m}return new Date(p.createdAt)-new Date(r.createdAt)}).slice(0,20);n(w,L,!0),n(b,L.length,!0)}else n(w,[],!0),n(b,0)}catch(t){console.error("Search failed:",t),n(w,[],!0),n(b,0)}finally{n(y,!1)}},gt=t=>{t.key==="Enter"&&G()},pt=async t=>{try{const a=await fetch(`/api/admin/guilds/${A().params.guild}/tickets/${t}/transcript`,{credentials:"include"});if(!a.ok)throw new Error("Failed to download transcript");const c=await a.blob(),f=window.URL.createObjectURL(c),v=document.createElement("a");v.href=f,v.download=`transcript-${t}.html`,document.body.appendChild(v),v.click(),window.URL.revokeObjectURL(f),document.body.removeChild(v)}catch(a){alert("Failed to download transcript: "+a.message)}};var J=ne(),X=d(Pt(J),2),F=s(X),j=s(F),Y=d(s(j),2),ut=s(Y,!0);i(Y),i(j);var Z=d(j,2),tt=d(s(Z),2),ft=s(tt);{var mt=t=>{var a=Zt();l(t,a)},xt=t=>{var a=W("Ready");l(t,a)},bt=t=>{var a=W("Waiting for search");l(t,a)};D(ft,t=>{e(y)?t(mt):e(T)?t(xt,1):t(bt,!1)})}i(tt),i(Z),i(F);var I=d(F,2),U=s(I),B=s(U),C=d(s(B),2);Wt(C),V(2),i(B);var et=d(B,2),E=d(s(et),2),M=s(E);M.value=M.__value="date";var at=d(M);at.value=at.__value="duration",i(E),i(et),i(U);var $=d(U,2),ht=s($);{var _t=t=>{var a=te();V(),l(t,a)},yt=t=>{var a=ee();V(),l(t,a)};D(ht,t=>{e(y)?t(_t):t(yt,!1)})}i($),i(I);var wt=d(I,2);{var kt=t=>{var a=ae();l(t,a)},Dt=t=>{var a=de(),c=s(a),f=s(c);i(c);var v=d(c,2);zt(v,17,()=>e(w),Kt,(L,r)=>{var p=ie(),m=s(p),h=s(m),O=s(h),Tt=d(s(O));i(O);var rt=d(O,2),st=s(rt),$t=d(st);{var Lt=o=>{var u=re(),z=d(s(u));i(u),S(()=>x(z,` ${e(r).userId??""}`)),l(o,u)};D($t,o=>{e(r).userId&&o(Lt)})}i(rt),i(h);var it=d(h,2),dt=s(it),Rt=s(dt);{var Ft=o=>{var u=W();S((z,Et)=>x(u,`${z??""}
									${Et??""}`),[()=>new Date(e(r).createdAt).toLocaleDateString(),()=>new Date(e(r).createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),l(o,u)};D(Rt,o=>{e(r).createdAt&&o(Ft)})}i(dt),i(it),i(m);var N=d(m,2),P=s(N),jt=d(s(P));i(P);var q=d(P,2),It=d(s(q));i(q);var Ut=d(q,2);{var Bt=o=>{var u=se();l(o,u)};D(Ut,o=>{e(r).open||o(Bt)})}i(N);var ot=d(N,2),lt=s(ot),Ct=d(lt,2);i(ot),i(p),S((o,u)=>{x(Tt,` ${(e(r).topic||`Ticket ${e(r).id}`)??""}`),x(st,`ID: ${e(r).id??""} `),x(jt,` Duration: ${o??""}`),x(It,` Size: ${u??""} KB`),Ht(Ct,"href",`/transcript/${e(r).id}`)},[()=>vt(e(r).createdAt,e(r).closedAt),()=>{var o;return((((o=e(r).htmlTranscript)==null?void 0:o.length)||0)/1024).toFixed(2)}]),K("click",lt,()=>pt(e(r).id)),l(L,p)}),i(a),S(()=>x(f,`Found ${e(b)??""} transcript${e(b)!==1?"s":""} (showing up to 20 results)`)),l(t,a)},St=t=>{var a=oe();l(t,a)},At=t=>{var a=le();l(t,a)};D(wt,t=>{e(y)?t(kt):e(w).length>0?t(Dt,1):e(T)?t(St,2):t(At,!1)})}i(X),S(()=>{x(ut,e(b)),$.disabled=e(y)}),K("keydown",C,gt),Qt(C,()=>e(_),t=>n(_,t)),Vt(E,()=>e(R),t=>n(R,t)),K("click",$,G),l(H,J),qt(),ct()}Mt(["keydown","click"]);export{ye as component,_e as universal};
