import"../chunks/B17Q6ahh.js";import"../chunks/Bzak7iHL.js";import{aU as Qt,p as Wt,d as w,U as Gt,i as e,h as Jt,t as L,aV as $,g as t,a as c,b as Xt,c as s,r as i,j as tt,s as d,f as u,aT as at}from"../chunks/CWXCXDbJ.js";import{s as _}from"../chunks/BTVB6o0Y.js";import{i as T}from"../chunks/BnKh12PZ.js";import{e as Yt,i as Zt}from"../chunks/DuqOsHh6.js";import{b as ta,r as aa,s as ea}from"../chunks/DNgBoiT1.js";import{b as ra}from"../chunks/C43HmXkP.js";import{s as sa,a as ia}from"../chunks/DeGpVRd_.js";import{p as oa}from"../chunks/CgrvsY6N.js";async function da({fetch:et,params:rt}){try{return{transcripts:[],totalTranscripts:0,searched:!1}}catch(I){return console.error("Failed to load transcripts:",I),{transcripts:[],totalTranscripts:0,searched:!1}}}const Pa=Object.freeze(Object.defineProperty({__proto__:null,load:da},Symbol.toStringTag,{value:"Module"}));var la=u('<span class="text-base">Searching...</span>'),na=u('<i class="fa-solid fa-spinner animate-spin mr-2"></i> Searching...',1),ca=u('<i class="fa-solid fa-search mr-2"></i> Search',1),va=u('<div class="rounded-lg bg-white p-12 shadow-sm dark:bg-slate-700 text-center"><i class="fa-solid fa-spinner animate-spin text-6xl text-gray-400 dark:text-gray-600 mb-4"></i> <p class="text-lg text-gray-600 dark:text-slate-400">Searching transcripts...</p></div>'),ga=u('<span class="ml-4"><i class="fa-solid fa-user"></i> </span>'),pa=u('<div class="inline-flex items-center gap-2 rounded-full bg-red-100 px-3 py-1 text-sm text-red-700 dark:bg-red-900/30 dark:text-red-300"><i class="fa-solid fa-check-circle"></i> Closed</div>'),ua=u('<div class="rounded-lg border border-gray-200 p-4 dark:border-gray-700"><div class="flex flex-col md:flex-row md:items-center md:justify-between mb-3"><div class="flex-1"><div class="font-semibold text-lg"><i class="fa-solid fa-hashtag text-gray-500 dark:text-slate-400"></i> </div> <div class="text-sm text-gray-600 dark:text-slate-400"> <!></div></div> <div class="mt-2 md:mt-0 text-right"><div class="text-sm font-medium text-gray-600 dark:text-slate-400"><!></div></div></div> <div class="flex flex-wrap gap-2 mb-4"><div class="inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-sm dark:bg-gray-800"><i class="fa-solid fa-clock"></i> </div> <div class="inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-sm dark:bg-gray-800"><i class="fa-solid fa-database"></i> </div> <!></div> <div class="flex gap-2"><button class="inline-flex items-center gap-2 rounded-lg bg-blue-300 px-4 py-2 font-medium transition duration-300 hover:bg-blue-500 hover:text-white dark:bg-blue-500/50 dark:hover:bg-blue-500"><i class="fa-solid fa-download"></i> Download HTML</button> <a target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 rounded-lg bg-gray-300 px-4 py-2 font-medium transition duration-300 hover:bg-gray-500 hover:text-white dark:bg-gray-700 dark:hover:bg-gray-600"><i class="fa-solid fa-external-link"></i> View Online</a></div></div>'),ba=u('<div class="flex items-center justify-center gap-2 mt-8"><button class="px-3 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 disabled:opacity-50 hover:bg-gray-300 dark:hover:bg-gray-600" title="First page"><i class="fa-solid fa-chevron-left"></i> <i class="fa-solid fa-chevron-left"></i></button> <button class="px-3 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 disabled:opacity-50 hover:bg-gray-300 dark:hover:bg-gray-600" title="Previous page"><i class="fa-solid fa-chevron-left"></i></button> <span class="px-4 py-2 font-medium"> </span> <button class="px-3 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 disabled:opacity-50 hover:bg-gray-300 dark:hover:bg-gray-600" title="Next page"><i class="fa-solid fa-chevron-right"></i></button> <button class="px-3 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 disabled:opacity-50 hover:bg-gray-300 dark:hover:bg-gray-600" title="Last page"><i class="fa-solid fa-chevron-right"></i> <i class="fa-solid fa-chevron-right"></i></button></div>'),fa=u('<div class="space-y-4"><div class="text-sm text-gray-600 dark:text-slate-400 mb-4"> </div> <!> <!></div>'),ma=u('<div class="rounded-lg bg-white p-12 shadow-sm dark:bg-slate-700 text-center"><i class="fa-solid fa-search text-6xl text-gray-400 dark:text-gray-600 mb-4"></i> <p class="text-lg text-gray-600 dark:text-slate-400">No transcripts found matching your search</p></div>'),xa=u('<div class="rounded-lg bg-white p-12 shadow-sm dark:bg-slate-700 text-center"><i class="fa-solid fa-inbox text-6xl text-gray-400 dark:text-gray-600 mb-4"></i> <p class="text-lg text-gray-600 dark:text-slate-400">Enter a search query to find transcripts</p> <p class="text-sm text-gray-500 dark:text-slate-500 mt-2">Search by ticket ID, topic, or user ID to view closed ticket transcripts</p></div>'),ha=u('<h1 class="m-4 text-center text-4xl font-bold">Ticket Transcripts & Archives</h1> <div class="mx-auto my-8 max-w-6xl px-4"><div class="grid grid-cols-1 gap-4 md:grid-cols-3 mb-8"><div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">Total Results</div> <div class="mt-2 text-3xl font-bold"> </div></div> <div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">Current Page</div> <div class="mt-2 text-3xl font-bold"> </div></div> <div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">Status <i class="fa-solid fa-circle-question cursor-help text-gray-400 text-sm" title="Search status"></i></div> <div class="mt-2 text-3xl font-bold"><!></div></div></div> <div class="mb-8 rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="grid grid-cols-1 gap-4 md:grid-cols-3"><div class="md:col-span-2"><label class="block text-sm font-semibold mb-2">Search Transcripts</label> <input type="text" placeholder="Search by topic, user ID, or ticket ID..." class="w-full rounded-lg border border-gray-200 bg-white px-4 py-2 dark:border-gray-600 dark:bg-slate-800"/> <p class="text-xs text-gray-500 dark:text-slate-400 mt-2">Press Enter or click Search to find transcripts</p></div> <div><label class="block text-sm font-semibold mb-2">Sort By</label> <select class="w-full rounded-lg border border-gray-200 bg-white px-4 py-2 dark:border-gray-600 dark:bg-slate-800"><option>Date (Newest First)</option><option>Duration (Longest First)</option></select></div></div> <button class="mt-4 rounded-lg bg-blurple px-6 py-2 font-medium text-white transition duration-300 hover:bg-blurple/80 disabled:opacity-50 disabled:cursor-not-allowed"><!></button></div> <!></div>',1);function Ra(et,rt){Wt(rt,!0);const I=()=>ia(oa,"$page",mt),[mt,xt]=sa();let A=w(""),E=w("date"),U=w(!1),m=w(!1),S=w(Gt([])),x=w(1),b=w(1),P=w(0),ht=20;const yt=(a,r)=>{if(!a||!r)return"N/A";const f=new Date(r)-new Date(a),h=Math.floor(f/36e5),g=Math.floor(f%36e5/6e4);return`${h}h ${g}m`},O=async(a=1)=>{var r,f;if(!t(A).trim()){d(S,[],!0),d(U,!1),d(P,0);return}d(m,!0),d(U,!0),d(x,a,!0);try{const h=new URLSearchParams({status:"closed",hasTranscript:"true",limit:ht.toString(),page:a.toString()}),g=await fetch(`/api/admin/guilds/${I().params.guild}/tickets?${h.toString()}`,{credentials:"include"});if(g.ok){const R=await g.json(),G=R.tickets||[],D=t(A).toLowerCase(),o=G.filter(n=>{var v,p,k;return((v=n.id)==null?void 0:v.toString().includes(t(A)))||((p=n.topic)==null?void 0:p.toLowerCase().includes(D))||((k=n.createdById)==null?void 0:k.toString().includes(t(A)))}).sort((n,v)=>{if(t(E)==="duration"){const p=new Date(n.closedAt)-new Date(n.createdAt);return new Date(v.closedAt)-new Date(v.createdAt)-p}return new Date(v.createdAt)-new Date(n.createdAt)});d(S,o,!0),d(P,((r=R.pagination)==null?void 0:r.total)||o.length,!0),d(b,((f=R.pagination)==null?void 0:f.totalPages)||1,!0)}else d(S,[],!0),d(P,0),d(b,1)}catch(h){console.error("Search failed:",h),d(S,[],!0),d(P,0),d(b,1)}finally{d(m,!1)}},_t=a=>{a.key==="Enter"&&O(1)},B=a=>{a>=1&&a<=t(b)&&O(a)},kt=async a=>{try{const r=await fetch(`/api/admin/guilds/${I().params.guild}/tickets/${a}/transcript`,{credentials:"include"});if(!r.ok)throw new Error("Failed to download transcript");const f=await r.blob(),h=window.URL.createObjectURL(f),g=document.createElement("a");g.href=h,g.download=`transcript-${a}.html`,document.body.appendChild(g),g.click(),window.URL.revokeObjectURL(h),document.body.removeChild(g)}catch(r){alert("Failed to download transcript: "+r.message)}};var st=ha(),it=e(Jt(st),2),M=s(it),N=s(M),ot=e(s(N),2),wt=s(ot,!0);i(ot),i(N);var z=e(N,2),dt=e(s(z),2),St=s(dt);i(dt),i(z);var lt=e(z,2),nt=e(s(lt),2),Dt=s(nt);{var $t=a=>{var r=la();c(a,r)},Tt=a=>{var r=at("Ready");c(a,r)},At=a=>{var r=at("Waiting for search");c(a,r)};T(Dt,a=>{t(m)?a($t):t(U)?a(Tt,1):a(At,!1)})}i(nt),i(lt),i(M);var q=e(M,2),K=s(q),V=s(K),H=e(s(V),2);aa(H),tt(2),i(V);var ct=e(V,2),Q=e(s(ct),2),W=s(Q);W.value=W.__value="date";var vt=e(W);vt.value=vt.__value="duration",i(Q),i(ct),i(K);var C=e(K,2),Lt=s(C);{var Pt=a=>{var r=na();tt(),c(a,r)},Rt=a=>{var r=ca();tt(),c(a,r)};T(Lt,a=>{t(m)?a(Pt):a(Rt,!1)})}i(C),i(q);var jt=e(q,2);{var Ft=a=>{var r=va();c(a,r)},It=a=>{var r=fa(),f=s(r),h=s(f);i(f);var g=e(f,2);Yt(g,17,()=>t(S),Zt,(D,o)=>{var n=ua(),v=s(n),p=s(v),k=s(p),j=e(s(k));i(k);var F=e(k,2),gt=s(F),Ct=e(gt);{var Et=l=>{var y=ga(),Z=e(s(y));i(y),L(()=>_(Z,` ${t(o).userId??""}`)),c(l,y)};T(Ct,l=>{t(o).userId&&l(Et)})}i(F),i(p);var pt=e(p,2),ut=s(pt),Ot=s(ut);{var Mt=l=>{var y=at();L((Z,Ht)=>_(y,`${Z??""}
									${Ht??""}`),[()=>new Date(t(o).createdAt).toLocaleDateString(),()=>new Date(t(o).createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),c(l,y)};T(Ot,l=>{t(o).createdAt&&l(Mt)})}i(ut),i(pt),i(v);var J=e(v,2),X=s(J),Nt=e(s(X));i(X);var Y=e(X,2),zt=e(s(Y));i(Y);var qt=e(Y,2);{var Kt=l=>{var y=pa();c(l,y)};T(qt,l=>{t(o).open||l(Kt)})}i(J);var bt=e(J,2),ft=s(bt),Vt=e(ft,2);i(bt),i(n),L((l,y)=>{_(j,` ${(t(o).topic||`Ticket ${t(o).id}`)??""}`),_(gt,`ID: ${t(o).id??""} `),_(Nt,` Duration: ${l??""}`),_(zt,` Size: ${y??""} KB`),ea(Vt,"href",`/transcript/${t(o).id}`)},[()=>yt(t(o).createdAt,t(o).closedAt),()=>{var l;return((((l=t(o).htmlTranscript)==null?void 0:l.length)||0)/1024).toFixed(2)}]),$("click",ft,()=>kt(t(o).id)),c(D,n)});var R=e(g,2);{var G=D=>{var o=ba(),n=s(o),v=e(n,2),p=e(v,2),k=s(p);i(p);var j=e(p,2),F=e(j,2);i(o),L(()=>{n.disabled=t(x)===1||t(m),v.disabled=t(x)===1||t(m),_(k,`Page ${t(x)??""} of ${t(b)??""}`),j.disabled=t(x)===t(b)||t(m),F.disabled=t(x)===t(b)||t(m)}),$("click",n,()=>B(1)),$("click",v,()=>B(t(x)-1)),$("click",j,()=>B(t(x)+1)),$("click",F,()=>B(t(b))),c(D,o)};T(R,D=>{t(b)>1&&D(G)})}i(r),L(()=>_(h,`Showing page ${t(x)??""} of ${t(b)??""} (${t(S).length??""} results on this page)`)),c(a,r)},Ut=a=>{var r=ma();c(a,r)},Bt=a=>{var r=xa();c(a,r)};T(jt,a=>{t(m)?a(Ft):t(S).length>0?a(It,1):t(U)?a(Ut,2):a(Bt,!1)})}i(it),L(()=>{_(wt,t(P)),_(St,`${t(x)??""} / ${t(b)??""}`),C.disabled=t(m)}),$("keydown",H,_t),ra(H,()=>t(A),a=>d(A,a)),ta(Q,()=>t(E),a=>d(E,a)),$("click",C,()=>O(1)),c(et,st),Xt(),xt()}Qt(["keydown","click"]);export{Ra as component,Pa as universal};
