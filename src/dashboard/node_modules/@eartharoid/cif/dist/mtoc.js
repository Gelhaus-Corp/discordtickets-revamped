import control from './control.js';
export default function mtoc(messages) {
    const sorted = messages.sort(([a], [b]) => a.split('.').length - b.split('.').length);
    let cif = 'version=1' + control.RS;
    let prefix = '';
    for (const [key, value] of sorted) {
        const parts = key.split('.');
        if (parts.length > 1) {
            const c_prefix = parts.slice(0, -1).join('.');
            if (c_prefix !== prefix) {
                prefix = c_prefix;
                cif += control.GS + c_prefix + control.RS;
            }
        }
        cif += prefix.length > 0 ? key.slice(prefix.length + 1) : key;
        if ('p' in value) {
            value.p.forEach(([pos, data]) => {
                let name;
                if ('v' in data)
                    name = data.v;
                else
                    name = JSON.stringify(data);
                cif += '\t' + pos + '\t' + name;
            });
        }
        if ('q' in value) {
            cif += control.US + control.NUL + new URLSearchParams(value.q).toString() + control.RS;
        }
        else {
            cif += control.US + value.t + control.RS;
        }
    }
    return cif.slice(0, -1);
}
