import"../chunks/B17Q6ahh.js";import"../chunks/Bzak7iHL.js";import{p as pt,i as e,h as Rt,t as f,a as g,b as At,c as a,r as t,f as x,g as v,aT as Ft,u as X,aU as jt}from"../chunks/_fu6EM7d.js";import{s as o}from"../chunks/DbFbsu9R.js";import{i as H}from"../chunks/BkvMZOlF.js";import{e as F,i as j}from"../chunks/CdfWQzPM.js";import{s as Ct}from"../chunks/BZKIRd09.js";import{s as Y}from"../chunks/B_DfNNzh.js";import{s as Nt}from"../chunks/CG3JaKlL.js";import{s as Ot,a as Tt}from"../chunks/CzA9-LZ0.js";import{b as Dt}from"../chunks/D_9zKCAW.js";import{p as Pt}from"../chunks/DixFDlud.js";async function Bt({fetch:z,params:r}){const G={credentials:"include"};try{const[U,I,J]=await Promise.all([z(`/api/admin/guilds/${r.guild}/feedback?limit=100`,G),z(`/api/admin/guilds/${r.guild}/analytics`,G),z(`/api/admin/guilds/${r.guild}/categories`,G)]),E=U.ok?await U.json():{feedback:[]},K=I.ok?await I.json():null,Q=J.ok?await J.json():[],c=E.feedback||[],V={total:E.totalCount||c.length,avgRating:E.avgRating||(c.length>0?(c.reduce((n,R)=>n+(R.rating||0),0)/c.length).toFixed(2):0),byRating:E.ratingCounts||{5:c.filter(n=>n.rating===5).length,4:c.filter(n=>n.rating===4).length,3:c.filter(n=>n.rating===3).length,2:c.filter(n=>n.rating===2).length,1:c.filter(n=>n.rating===1).length}},T={};return c.forEach(n=>{const R=n.categoryName||"Unknown";T[R]||(T[R]=[]),T[R].push(n)}),{feedback:c,stats:V,feedbackByCategory:T,analytics:K,categories:Q}}catch(U){return console.error("Failed to load feedback data:",U),{feedback:[],stats:{total:0,avgRating:0,byRating:{5:0,4:0,3:0,2:0,1:0}},feedbackByCategory:{},analytics:null,categories:[]}}}const va=Object.freeze(Object.defineProperty({__proto__:null,load:Bt},Symbol.toStringTag,{value:"Module"}));var St=x("<i></i>"),Ut=x('<i class="fa-solid fa-star text-yellow-500"></i>'),Et=x('<i class="fa-solid fa-star text-gray-300"></i>'),Lt=x('<div class="flex items-center gap-4"><div class="w-20"><div class="flex items-center gap-1"><!> <!></div> <span class="text-sm font-medium"> </span></div> <div class="flex-1 bg-gray-200 dark:bg-gray-600 rounded-full h-8 overflow-hidden"><div class="bg-yellow-500 h-full flex items-center justify-center text-white text-sm font-medium"><!></div></div> <div class="w-12 text-right font-semibold"> </div></div>'),Mt=x("<i></i>"),zt=x('<div class="text-center"><div class="text-sm font-medium"> </div> <div class="text-lg font-bold text-yellow-600"> </div> <div class="text-xs text-gray-500"> </div></div>'),Gt=x('<div class="rounded-lg border border-gray-200 p-4 dark:border-gray-600"><div class="flex items-center justify-between mb-3"><div class="font-semibold text-lg"> </div> <div class="flex items-center gap-2"><span class="text-sm text-gray-600 dark:text-slate-400"> </span> <div class="flex gap-1"></div> <span class="ml-4 text-sm font-medium text-gray-600 dark:text-slate-400"> </span></div></div> <div class="flex gap-4"></div></div>'),Vt=x('<div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700 mb-8"><h2 class="mb-6 text-2xl font-bold">Feedback by Category</h2> <div class="space-y-4"></div></div>'),qt=x("<i></i>"),Ht=x('<p class="text-sm italic"> </p>'),It=x('<div class="mt-2 text-xs text-gray-500"> </div>'),Jt=x('<div><div class="flex items-start justify-between mb-2"><div><div class="font-semibold"> </div> <div class="text-sm text-gray-600 dark:text-slate-400"> </div></div> <div class="flex gap-1"></div></div> <!> <!></div>'),Kt=x('<div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><h2 class="mb-6 text-2xl font-bold">Recent Feedback</h2> <div class="space-y-4 max-h-96 overflow-y-auto"></div></div>'),Qt=x('<div class="rounded-lg bg-white p-12 shadow-sm dark:bg-slate-700 text-center"><i class="fa-solid fa-inbox text-6xl text-gray-400 dark:text-gray-600 mb-4"></i> <p class="text-lg text-gray-600 dark:text-slate-400">No feedback yet</p></div>'),Wt=x('<h1 class="m-4 text-center text-4xl font-bold">Feedback & Analytics</h1> <div class="mx-auto my-8 max-w-6xl px-4"><div class="grid grid-cols-1 gap-4 md:grid-cols-4 mb-8"><div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">Total Feedback</div> <div class="mt-2 text-3xl font-bold"> </div></div> <div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">Average Rating</div> <div class="mt-2 text-3xl font-bold"> </div> <div class="mt-1 flex gap-1"></div></div> <div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">Excellent (5★)</div> <div class="mt-2 text-3xl font-bold text-green-600"> </div></div> <div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700"><div class="text-sm font-semibold text-gray-600 dark:text-slate-400">Poor (1★)</div> <div class="mt-2 text-3xl font-bold text-red-600"> </div></div></div> <div class="rounded-lg bg-white p-6 shadow-sm dark:bg-slate-700 mb-8"><h2 class="mb-6 text-2xl font-bold">Rating Distribution</h2> <div class="space-y-4"></div></div> <!> <!> <div class="mt-8 text-center"><a class="inline-block rounded-lg bg-blurple px-6 py-2 text-white transition duration-300 hover:bg-blurple/80">View Full Feedback Portal <i class="fa-solid fa-arrow-right-long ml-2"></i></a></div></div>',1);function oa(z,r){pt(r,!0);const G=()=>Tt(Pt,"$page",U),[U,I]=Ot(),J=i=>({5:"Excellent",4:"Good",3:"Okay",2:"Poor",1:"Terrible"})[i]||"Unknown",E=i=>({5:"bg-green-100 dark:bg-green-900/30",4:"bg-blue-100 dark:bg-blue-900/30",3:"bg-yellow-100 dark:bg-yellow-900/30",2:"bg-orange-100 dark:bg-orange-900/30",1:"bg-red-100 dark:bg-red-900/30"})[i]||"bg-gray-100 dark:bg-gray-900/30";var K=Wt(),Q=e(Rt(K),2),c=a(Q),V=a(c),T=e(a(V),2),n=a(T,!0);t(T),t(V);var R=e(V,2),Z=e(a(R),2),ct=a(Z);t(Z);var rt=e(Z,2);F(rt,20,()=>Array(5),j,(i,s,_)=>{var y=St();f(l=>Y(y,1,l),[()=>`fa-solid fa-star text-sm ${_<Math.round(r.data.stats.avgRating)?"text-yellow-500":"text-gray-300"}`]),g(i,y)}),t(rt),t(R);var $=e(R,2),st=e(a($),2),xt=a(st,!0);t(st),t($);var it=e($,2),dt=e(a(it),2),bt=a(dt,!0);t(dt),t(it),t(c);var tt=e(c,2),lt=e(a(tt),2);F(lt,20,()=>[5,4,3,2,1],j,(i,s)=>{var _=Lt(),y=a(_),l=a(y),u=a(l);F(u,17,()=>Array(s),j,(b,k)=>{var d=Ut();g(b,d)});var D=e(u,2);F(D,17,()=>Array(5-s),j,(b,k)=>{var d=Et();g(b,d)}),t(l);var m=e(l,2),C=a(m,!0);t(m),t(y);var A=e(y,2),h=a(A),P=a(h);{var L=b=>{var k=Ft();f(()=>o(k,r.data.stats.byRating[s])),g(b,k)};H(P,b=>{r.data.stats.byRating[s]/r.data.stats.total*100>20&&b(L)})}t(h),t(A);var N=e(A,2),B=a(N,!0);t(N),t(_),f(b=>{o(C,b),Nt(h,`width: ${r.data.stats.total>0?r.data.stats.byRating[s]/r.data.stats.total*100:0}%`),o(B,r.data.stats.byRating[s])},[()=>J(s)]),g(i,_)}),t(lt),t(tt);var vt=e(tt,2);{var mt=i=>{var s=Vt(),_=e(a(s),2);F(_,21,()=>Object.entries(r.data.feedbackByCategory),j,(y,l)=>{var u=X(()=>jt(v(l),2));let D=()=>v(u)[0],m=()=>v(u)[1];const C=X(()=>(m().reduce((p,S)=>p+(S.rating||0),0)/m().length).toFixed(2));var A=Gt(),h=a(A),P=a(h),L=a(P,!0);t(P);var N=e(P,2),B=a(N),b=a(B);t(B);var k=e(B,2);F(k,20,()=>Array(5),j,(p,S,W)=>{var M=Mt();f(q=>Y(M,1,q),[()=>`fa-solid fa-star text-sm ${W<Math.round(v(C))?"text-yellow-500":"text-gray-300"}`]),g(p,M)}),t(k);var d=e(k,2),w=a(d);t(d),t(N),t(h);var O=e(h,2);F(O,20,()=>[5,4,3,2,1],j,(p,S)=>{const W=X(()=>m().filter(et=>et.rating===S).length);var M=zt(),q=a(M),ht=a(q);t(q);var at=e(q,2),kt=a(at,!0);t(at);var gt=e(at,2),wt=a(gt);t(gt),t(M),f(et=>{o(ht,`${S??""}★`),o(kt,v(W)),o(wt,`${et??""}%`)},[()=>(v(W)/m().length*100).toFixed(0)]),g(p,M)}),t(O),t(A),f(()=>{o(L,D()),o(b,`${v(C)??""} / 5`),o(w,`${m().length??""} feedback`)}),g(y,A)}),t(_),t(s),g(i,s)},_t=X(()=>Object.keys(r.data.feedbackByCategory).length>0);H(vt,i=>{v(_t)&&i(mt)})}var ot=e(vt,2);{var ft=i=>{var s=Kt(),_=e(a(s),2);F(_,21,()=>r.data.feedback.slice(0,20),j,(y,l)=>{var u=Jt(),D=a(u),m=a(D),C=a(m),A=a(C,!0);t(C);var h=e(C,2),P=a(h);t(h),t(m);var L=e(m,2);F(L,20,()=>Array(5),j,(d,w,O)=>{var p=qt();f(()=>Y(p,1,`fa-solid fa-star text-sm ${O<v(l).rating?"text-yellow-500":"text-gray-400"}`)),g(d,p)}),t(L),t(D);var N=e(D,2);{var B=d=>{var w=Ht(),O=a(w);t(w),f(()=>o(O,`"${v(l).comment??""}"`)),g(d,w)};H(N,d=>{v(l).comment&&d(B)})}var b=e(N,2);{var k=d=>{var w=It(),O=a(w);t(w),f((p,S)=>o(O,`${p??""} at 
								${S??""}`),[()=>new Date(v(l).createdAt).toLocaleDateString(),()=>new Date(v(l).createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]),g(d,w)};H(b,d=>{v(l).createdAt&&d(k)})}t(u),f(d=>{Y(u,1,d),o(A,v(l).categoryName||"Unknown"),o(P,`Ticket #${(v(l).ticketNumber||"N/A")??""}`)},[()=>`rounded-lg p-4 ${E(v(l).rating)}`]),g(y,u)}),t(_),t(s),g(i,s)},yt=i=>{var s=Qt();g(i,s)};H(ot,i=>{r.data.feedback.length>0?i(ft):i(yt,!1)})}var nt=e(ot,2),ut=a(nt);t(nt),t(Q),f(()=>{o(n,r.data.stats.total),o(ct,`${r.data.stats.avgRating??""} / 5`),o(xt,r.data.stats.byRating[5]),o(bt,r.data.stats.byRating[1]),Ct(ut,"href",`${Dt}/${G().params.guild}/feedback`)}),g(z,K),At(),I()}export{oa as component,va as universal};
